<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>CTI Nethesis 0.1</title>

	<link type="text/css" href="jquery.jixedbar-0.0.5-branch/themes/default/jx.stylesheet.css" rel="stylesheet"/>
	<link rel="stylesheet" type="text/css" href="css/style.css" media="all" />  
	<link rel="stylesheet" type="text/css" href="css/jquery-ui-1.8.10.custom.css" media="all" />  

	<script type="text/javascript" src="jquery.jixedbar-0.0.5-branch/jquery-1.4.2.min.js"></script>
	<script type="text/javascript" src="jquery.jixedbar-0.0.5-branch/src/jquery.jixedbar.min.js"></script>
	<script type="text/javascript" src="js/jquery-ui-1.8.10.custom.min.js"></script>
	<script type="text/javascript" src="js/jquery-jvert-tabs-1.1.4.js"></script>

	<script src="/json.js"></script> <!-- for ie -->
   <script src="/lib/socket.io-client/socket.io.js"></script>
   <script src="content_script.js"></script>
	<script src="updategui.js"></script>

	<style type="text/css"> 
		/* Vertical Tabs
		----------------------------------*/
		.ui-tabs-vertical { width: 55em; }
		.ui-tabs-vertical .ui-tabs-nav { padding: 0em .8em .2em .2em; float: left; width: 12em; }
		.ui-tabs-vertical .ui-tabs-nav li { padding-right: .8em; clear: left; width: 100%; border-bottom-width: 1px !important; border-right-width: 0 !important; margin: 0 -1px .2em 0; }
		.ui-tabs-vertical .ui-tabs-nav li a { display:block; }
		.ui-tabs-vertical .ui-tabs-nav li.ui-tabs-selected { padding-bottom: 0; padding-right: .9em;  border-right-width: 1px; border-	right-width: 1px; }
		.ui-tabs-vertical .ui-tabs-panel {  padding: 1em; float: right; width: 40em;}
	</style> 
	
	

</head>

<body onload='window.webkitNotifications.requestPermission();'>

	<script>
		bg = '';
    	var slideDelay = 200;	
   </script>
	
	
	<div id="container">
	
		<div id="header">
			
			<img src='../images/logo_nethesis.png' id='logo'/>
			<a href="#" id="logout" style='display:none'>Logout</a><br/>
			<div id='buttoncall' style='display:none'>
					<label id='info_calling'></label>
					<input type='button' id='hangup' value='Hangup'/>
					<input type='button' id='waiting' value='Waiting' disabled='true'/>
					<input type='button' id='record' value='Record' disabled='true'/><br/>
					<label>Redirect to: </label><input type='text' id='redirect_to'/><input type='button' id='redirect' value='Redirect' disabled='true'/>
			</div>
			<br/><br/><br/><br/>		
		</div>
		
      <div id="tabs">
      		<ul id='tab_list'>	
				<li><a href="#tabs-0" class='tab_login'>Login</a></li>
				<li><a href="#tabs-1" class='tab_phonebook'>Phonebook</a></li>
				<li><a href="#tabs-2" class='tab_history'>History</a></li>
			</ul>
			
			<div id="tabs-0" class='tab_login'>
			   	<div id='login_div'>
				  	<label for='ext' >Extension:</label><input type='text' name='ext' id='ext' value='500'/>
	    			<label for='secret' >Secret:</label><input type='text' name='secret' id='secret' value='500'/>      
				   <input type='button' id='login' value='Login'/>   
				   <label id='info_login'></label>
				   <br/>
				</div>
	      </div>
			
		   <div id="tabs-1" class='tab_phonebook'>
		   	<div id="content-wrapper">
		   	   <div id="content">
		            
		         	<div id="address" style='display:block'>
							<label class='ui-widget'>Search:   </label><input type="text" id="searchcontact" name="searchcontact"/>
							<br/><br/>
							<div id="searchContacts">
							</div> 
						</div>
						<div id="resultsContainer"></div>
	
	
        </div>

		</div>   
		</div>
		<div id="tabs-2" class='tab_history'>
		   	<div id="content-wrapper">
		   	   <div id="content">
		      	<p>History</p>      
		       </div>
		    </dv>
		</div>
        
      </div> 
      
   </div>
   
   
   
   
   
    <script>
    
    	$(function(){
    
	        $( "#tabs" ).tabs().addClass('ui-tabs-vertical ui-helper-clearfix');;
	        $("#tabs li").removeClass('ui-corner-top').addClass('ui-corner-left');
	        $("#sample-bar").jixedbar();
	
			$('#tabs').tabs("select", 0);	
	        $('.tab_phonebook').hide();
	        $('.tab_history').hide();
	        
	
		
    		if (window.webkitNotifications) {
				console.log("Notifications are supported!");
			}
			else {
				var msg = "Notifications are not supported for this Browser/OS version yet.";
				console.log(msg);
				return;
			}
    	
    	
    		if (window.webkitNotifications.checkPermission() == 0) { // 0 is PERMISSION_ALLOWED
		    	// function defined in step 2
			    console.log("Notification allowed");
			} else {
				console.log("Notification NOT allowed");
				$('#info_notification').slideDown(slideDelay);
			}
			
			if(localStorage.getItem('user')!=null && localStorage.getItem('user')!=undefined){
				updateAckLoginGui();
			}
			
			bg = chrome.extension.getBackgroundPage();
			if(bg){
				console.log("ok background is present");
			} else{
				console.log("Error: background is null");
			}
			
			
			// live search of phonebook contacts
			$("#searchcontact").keyup(function(){
				var extFrom = localStorage.getItem('user');
				var namex = $("#searchcontact").val();
				if(namex.length>=2){
					bg.doSearchContact({extFrom: extFrom, namex: namex, action: 'search_contact_phonebook'});
				}
			});		
			
			
			if(localStorage.getItem('user')!=undefined && localStorage.getItem('user')!=null){
				var cust = localStorage.getItem('lastCustomerCard');
				console.log(cust);
				if(cust!=null && cust!=undefined){
					$("#tabs").tabs("add", "#tabs-3", "Customer card");
					$('#tabs').tabs('select', 3);
					$('#tabs-3').append(cust);
				}
			}
		});
		
		
		$('#enable').click(function() {
			window.webkitNotifications.requestPermission(function(){
				$('#info_notification').slideUp(slideDelay);
			});	
		});


		$('#login').click(function(){
			
			var user = localStorage.getItem('user');
			if(user!=null && user!='undefined'){
				//updateAckLoginGui();
				console.log('You are already logged in !');
  				return;
		  	}
		  	
			var extFrom = document.querySelector('#ext').value;
		    var secret =  document.querySelector('#secret').value;
		    bg.doLogin({ extFrom: extFrom, secret: secret, action: "login" });

		});

		$('#call').click(function(){

		    var extFrom = localStorage.getItem('user');
    		var extToCall =  $('#extToCall').val();
    		
    		if(extFrom==extToCall){    		
    			$('#info_calling').slideDown(slideDelay);
    			$('#info_calling').text('Attention: you trying to call yourself !');
    			return;
    		}
    		
    		bg.doCall({ extToCall: extToCall, extFrom: extFrom, action: "call_out_from_client" });
    		
			$('#info_calling').slideDown(slideDelay);
		    $('#info_calling').text('Calling...');
		    document.getElementById('call').value = 'Calling...';
		    $('#call').attr('disabled', true);
		    $('#buttoncall').slideDown(slideDelay);
		    $('#login_div').slideUp(slideDelay);
		    $('#address').slideUp(slideDelay);
		});
		
		$('#hangup').click(function(){
			var extFrom = localStorage.getItem('user');
			bg.doHangup({ extFrom: extFrom, action: "hangup" });
		});
		
		$('#logout').click(function(){
			var extFrom =  localStorage.getItem('user');
			bg.doLogout({ extFrom: extFrom, action: "logout" });
			$('#buttoncall').hide();
			$('#tabs-3').hide();
		});
		
		$('#waiting').click(function(){
			console.log("to implement");
		},false);
		
		
		$('#redirect').click(function(){
	
			var extFrom = localStorage.getItem('user');
			var redirectTo = $('#redirect_to').val();
		
			bg.doRedirect({extFrom: extFrom, redirectTo: redirectTo, action: 'redirect'});
   			$('#redirect').attr('enabled',false);
		},false);
		
		
		
		$('#record').click(function(){
		
			var buttonValue = $('#record').val();
			var extFrom = localStorage.getItem('user');
			
			if(buttonValue == 'Record'){
				bg.doStartRecord({ extFrom: extFrom, action: 'record' });
			}
			else{ // stop recording
				bg.doStopRecord({ extFrom: extFrom, action: 'stoprecord' });
			}	
		});


		// This is function is for clicck to call on result of searching contacts on phonebook
		callExt = function(extToCall){
		
			var extFrom = localStorage.getItem('user');
			
    		if(extFrom==extToCall){
	    		$('#info_calling').slideDown(slideDelay);
    			document.getElementById('info_calling').innerHTML = 'Attention: you trying to call yourself !';
    			return;
    		}
    		
    		bg.doCall({ extToCall: extToCall, extFrom: extFrom, action: "call_out_from_client" });
    		
		    $('#info_calling').text('Calling...');
		    document.getElementById('call').value = 'Calling...';
		    $('#call').attr('disabled', true);
		    $('#info_calling').slideDown(slideDelay);
		    $('#buttoncall').slideDown(slideDelay);
		    $('#login_div').slideUp(slideDelay);
			$('#address').slideUp(slideDelay, function(){
				$('#searchContacts').empty();
	      		$('#searchcontact').val('');
			});	
		}

		
    </script> 
   
   
   
   
   
   
</body>

</html>

